# üìö Refer√™ncia de C√≥digo

Este documento detalha as principais estruturas (structs), m√©todos e fun√ß√µes do projeto, organizados por arquivo para facilitar a consulta.

---

### `src/calc_preco.rs`

Respons√°vel pelos c√°lculos de valores e relat√≥rios financeiros.

- **Fun√ß√µes:**
  - `calcular_lucro_total(conn: &Connection) -> Result<f64>`: Calcula a soma dos pre√ßos de todos os agendamentos conclu√≠dos.
  - `calcular_lucro_mensal(conn: &Connection) -> Result<f64>`: Calcula o lucro de todos os agendamentos conclu√≠dos no m√™s corrente.
  - `calcular_lucro_do_dia(conn: &Connection) -> Result<f64>`: Calcula o lucro de todos os agendamentos conclu√≠dos no dia corrente.

---

### `src/licenca.rs`

Gerencia a l√≥gica de licenciamento do sistema.

- **Fun√ß√µes:**
  - `verificar_licenca_sistema(conn: &Connection) -> Result<bool>`: Checa se a licen√ßa do sistema est√° dentro da validade.
  - `atualizar_licenca(conn: &Connection, cliente_id: i32, nova_data: NaiveDateTime) -> Result<()>`: Atualiza a data de validade da licen√ßa de um cliente.
  - `gerar_codigo_semanal(chave: &str) -> String`: Gera um c√≥digo de ativa√ß√£o baseado em uma chave secreta e na semana atual.
  - `gerar_codigo_mensal(chave: &str) -> String`: Gera um c√≥digo de ativa√ß√£o baseado em uma chave secreta e no m√™s atual.
  - `validar_codigo(codigo_digitado: &str, chave: &str) -> Option<NaiveDateTime>`: Valida se um c√≥digo digitado corresponde ao c√≥digo semanal ou mensal e retorna a nova data de validade.

---

### `src/main.rs`

Ponto de entrada da aplica√ß√£o.

- **Fun√ß√µes:**
  - `main() -> Result<()>`: Fun√ß√£o principal que inicia o programa e chama o menu interativo.

---

### `src/menu.rs`

Controla toda a interface de linha de comando (CLI) para intera√ß√£o com o usu√°rio.

- **Fun√ß√µes:**
  - `menu_principal() -> Result<()>`: Exibe o menu principal e gerencia a navega√ß√£o do usu√°rio.
  - `cadastrar_cliente(conn: &Connection) -> Result<()>`: Coleta os dados e cadastra um novo cliente.
  - `agendar_servico(conn: &Connection) -> Result<()>`: Guia o usu√°rio no processo de criar um novo agendamento.
  - `ver_agendamentos(conn: &Connection) -> Result<()>`: Lista todos os agendamentos.
  - `validar_licenca_terminal(conn: &Connection) -> Result<()>`: Interface para o usu√°rio validar uma licen√ßa.
  - `gerar_relatorio_terminal(conn: &Connection) -> Result<()>`: Interface para gerar relat√≥rios de lucro.
  - `cadastrar_servico(conn: &Connection) -> Result<()>`: Coleta os dados e cadastra um novo servi√ßo.
  - `excluir_servico_terminal(conn: &Connection) -> Result<()>`: Remove um servi√ßo existente.
  - `excluir_cliente_terminal(conn: &Connection) -> Result<()>`: Remove um cliente existente.
  - `excluir_agendamento_terminal(conn: &Connection) -> Result<()>`: Remove um agendamento.
  - `editar_servico_terminal(conn: &Connection) -> Result<()>`: Altera os dados de um servi√ßo.
  - `editar_cliente_terminal(conn: &Connection) -> Result<()>`: Altera os dados de um cliente.
  - `editar_agendamento_terminal(conn: &Connection) -> Result<()>`: Altera os dados de um agendamento.
  - `listar_clientes_terminal(conn: &Connection) -> Result<()>`: Exibe todos os clientes.
  - `listar_servicos_terminal(conn: &Connection) -> Result<()>`: Exibe todos os servi√ßos.
  - `listar_agendamentos_terminal(conn: &Connection) -> Result<()>`: Exibe todos os agendamentos com detalhes.
  - `marcar_agendamento_concluido(conn: &Connection) -> Result<()>`: Marca um agendamento como "conclu√≠do".
  - `listar_agendamentos_por_status(conn: &Connection, concluido: bool) -> Result<()>`: Filtra e exibe agendamentos por status (pendente/conclu√≠do).
  - `relatorio_produtividade_mensal(conn: &Connection) -> Result<()>`: Exibe o relat√≥rio de lucro do m√™s.
  - `relatorio_produtividade_do_dia(conn: &Connection) -> Result<()>`: Exibe o relat√≥rio de lucro do dia.

---

### `src/db/mod.rs`

M√≥dulo central para todas as opera√ß√µes de banco de dados com `rusqlite`.

- **Fun√ß√µes:**
  - `conectar_db() -> Result<Connection>`: Abre uma conex√£o com o arquivo do banco de dados.
  - `criar_tabelas(conn: &Connection) -> Result<()>`: Cria as tabelas do banco de dados se elas n√£o existirem.
  - `salvar_cliente(conn: &Connection, cliente: &mut Cliente) -> Result<i32>`: Insere um novo cliente no banco.
  - `listar_clientes(conn: &Connection) -> Result<Vec<Cliente>>`: Retorna uma lista de todos os clientes.
  - `buscar_cliente_por_id(conn: &Connection, id: i32) -> Result<Option<Cliente>>`: Busca um cliente pelo seu ID.
  - `salvar_agendamento(conn: &Connection, agendamento: &Agendamento) -> Result<i32>`: Insere um novo agendamento.
  - `buscar_agendamento_por_id(conn: &Connection, id: i32) -> Result<Agendamento>`: Busca um agendamento pelo seu ID.
  - `listar_agendamentos(conn: &Connection) -> Result<Vec<Agendamento>>`: Retorna todos os agendamentos.
  - `verificar_conflito(conn: &Connection, data_hora: NaiveDateTime) -> Result<bool>`: Verifica se j√° existe um agendamento em um hor√°rio espec√≠fico.
  - `atualizar_agendamento(...) -> Result<()>`: Atualiza os dados de um agendamento.
  - `excluir_agendamento(conn: &Connection, id: i32) -> Result<()>`: Remove um agendamento do banco.
  - `excluir_cliente(conn: &Connection, id: i32) -> Result<()>`: Remove um cliente, se ele n√£o tiver agendamentos.
  - `listar_agendamentos_por_data(conn: &Connection, data: NaiveDateTime) -> Result<Vec<Agendamento>>`: Lista agendamentos de uma data espec√≠fica.
  - `listar_agendamentos_por_cliente(conn: &Connection, cliente_id: i32) -> Result<Vec<Agendamento>>`: Lista agendamentos de um cliente.
  - `salvar_servico(conn: &Connection, servico: &Servico) -> Result<i32>`: Insere um novo servi√ßo.
  - `listar_servicos(conn: &Connection) -> Result<Vec<Servico>>`: Retorna todos os servi√ßos.
  - `excluir_servico(conn: &Connection, id: i32) -> Result<()>`: Remove um servi√ßo do banco.
  - `buscar_nomes_servicos(conn: &Connection, ids: &[i32]) -> Result<Vec<String>>`: Retorna os nomes dos servi√ßos a partir de uma lista de IDs.

---

### `src/models/mod.rs`

Define as estruturas de dados (modelos) que representam as entidades do neg√≥cio.

- **Structs:**
  - `Cliente`: Representa um cliente da barbearia (ID, nome, telefone, email).
  - `Agendamento`: Representa um agendamento (ID, cliente, servi√ßos, data/hora, pre√ßo, status).
  - `Servico`: Representa um servi√ßo oferecido (ID, nome, pre√ßo).
  - `UsuarioSistema`: Representa um usu√°rio do sistema (n√£o totalmente implementado no CLI).

- **M√©todos:**
  - `impl Cliente`:
    - `new(nome: String, telefone: String, email: Option<String>) -> Self`: M√©todo construtor para criar uma nova inst√¢ncia de `Cliente`.
