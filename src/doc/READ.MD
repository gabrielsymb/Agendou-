# üíà Sistema de Agendamento da Barbearia (Web App)

Este documento descreve a nova arquitetura e o roteiro de desenvolvimento do sistema, que evoluiu de um prot√≥tipo em Rust para um aplicativo web moderno, offline-first e de alta performance.

## üéØ Objetivo Principal

Substituir a agenda de papel por um **aplicativo web funcional que roda em qualquer dispositivo, incluindo iPhones, sem depender de lojas de aplicativos**. O sistema oferece persist√™ncia de dados real no navegador, garantindo que o barbeiro possa trabalhar mesmo sem conex√£o com a internet.

## üöÄ Arquitetura Central

A nova abordagem combina o poder do Flutter para a interface com a robustez do SQLite para o banco de dados, tudo executado no lado do cliente.

- **Frontend:** **Flutter Web**, escolhido por sua capacidade de criar interfaces ricas, compiladas para um padr√£o web de alta performance (HTML, CSS, CanvasKit).
- **Banco de Dados:** **`sql.js`** (SQLite compilado para WebAssembly), que permite executar o banco de dados SQLite diretamente no navegador. Isso garante a reutiliza√ß√£o da l√≥gica de banco de dados j√° validada e a consist√™ncia dos dados.
- **Camada de Persist√™ncia:**
  - **Prim√°ria:** **Origin Private File System (OPFS)**, uma API moderna que oferece acesso a um sistema de arquivos privado e de alta performance. O banco de dados √© salvo como um arquivo, eliminando os gargalos do `IndexedDB`.
  - **Fallback:** **`IndexedDB`**, utilizada como uma alternativa robusta para navegadores que ainda n√£o suportam OPFS, garantindo ampla compatibilidade.
- **Sincroniza√ß√£o:** O sistema foi projetado para ser resiliente. O banco de dados √© **restaurado automaticamente** da camada de persist√™ncia ao iniciar o app e **salvo ap√≥s cada opera√ß√£o**, prevenindo a perda de dados.

---

##  Kanban de Desenvolvimento (Nova Fase)

O backlog abaixo reflete as etapas para a constru√ß√£o do aplicativo web.

### üîπ FASE 1: Persist√™ncia Web & Funda√ß√£o

- `[WEB-1]` Configurar um projeto base **Flutter Web**.
- `[WEB-2]` Integrar **`sql.js`** e testar a execu√ß√£o de comandos SQLite b√°sicos no navegador.
- `[WEB-3]` Implementar a camada de persist√™ncia com detec√ß√£o de **OPFS** e fallback para **`IndexedDB`**.
- `[WEB-4]` Criar a l√≥gica para carregar o banco de dados na inicializa√ß√£o e salv√°-lo ap√≥s cada transa√ß√£o (escrita, atualiza√ß√£o, exclus√£o).
- `[WEB-5]` Portar o esquema do banco de dados (`CREATE TABLE`s) do `db/mod.rs` para o ambiente web.

### üîπ FASE 2: L√≥gica de Neg√≥cios & Interface (UI)

- `[UI-1]` Desenvolver as telas principais com Flutter: Dashboard, Agendamentos, Clientes, Servi√ßos e Relat√≥rios.
- `[LOGIC-1]` Portar as opera√ß√µes de **CRUD de Clientes e Servi√ßos** da l√≥gica Rust para Dart/Flutter.
- `[LOGIC-2]` Portar a l√≥gica de **agendamento**, incluindo a verifica√ß√£o de conflitos de hor√°rio.
- `[LOGIC-3]` Portar a gera√ß√£o de **relat√≥rios de produtividade** (lucro di√°rio, mensal, total).
- `[UI-2]` Criar formul√°rios para cadastrar e editar clientes, servi√ßos e agendamentos.

### üîπ FASE 3: Progressive Web App (PWA) & Funcionalidades Avan√ßadas

- `[PWA-1]` Configurar o app Flutter para ser um **Progressive Web App (PWA)**, permitindo que seja "instalado" na tela inicial dos dispositivos.
- `[PWA-2]` Implementar um **Service Worker** para cache de recursos e melhor performance offline.
- `[FEATURE-1]` (Opcional) Reavaliar e, se necess√°rio, reimplementar a l√≥gica de licenciamento no contexto web.
- `[FEATURE-2]` (Opcional) Adicionar notifica√ß√µes push para lembretes de agendamento.

---

### ‚úÖ Legado (Backend Rust - Conclu√≠do)

A implementa√ß√£o original em Rust serviu como uma excelente prova de conceito e continua sendo uma refer√™ncia valiosa para a l√≥gica de neg√≥cios.

- **Structs com `serde`**
- **Conex√£o com SQLite (`rusqlite`)**
- **Tabelas de Clientes, Servi√ßos e Agendamentos**
- **CRUD para Clientes e Servi√ßos**
- **Cria√ß√£o de agendamentos com `chrono`**
- **Verifica√ß√£o de conflito de hor√°rio**
- **C√°lculo de pre√ßo e lucro**
- **Relat√≥rios de produtividade (dia, m√™s, total)**
- **Marcar agendamento como conclu√≠do**
- **Remarcar/realocar agendamentos**